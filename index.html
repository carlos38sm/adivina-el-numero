<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Juego: Adivina el n√∫mero</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f4f4f4; }
    input, button { margin: 0.5rem 0; padding: 0.5rem; }
    #resultado, #mensajeGuardado { margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body>
  <h1>¬°Adivina el n√∫mero del 1 al 100!</h1>
  <p>Tienes <span id="intentos">10</span> intentos</p>
  <input type="number" id="entrada" min="1" max="100" />
  <button onclick="comprobar()">Comprobar</button>
  <p id="resultado"></p>

  <hr>
  <h2>Guardar tu partida</h2>
  <label for="nombre">Tu nombre:</label>
  <input type="text" id="nombre" />

  <button id="guardar">Guardar partida</button>
  <p id="mensajeGuardado"></p>

  <script>
    // ---------- L√ìGICA DEL JUEGO ----------
    const numeroSecreto = Math.floor(Math.random() * 100) + 1;
    let intentos = 10;

    function comprobar() {
      const entrada = parseInt(document.getElementById('entrada').value);
      const resultado = document.getElementById('resultado');

      if (isNaN(entrada) || entrada < 1 || entrada > 100) {
        resultado.textContent = 'Introduce un n√∫mero v√°lido entre 1 y 100.';
        return;
      }

      if (intentos <= 0) {
        resultado.textContent = 'üò¢ ¬°Te has quedado sin intentos!';
        return;
      }

      intentos--;
      document.getElementById('intentos').textContent = intentos;

      if (entrada === numeroSecreto) {
        resultado.textContent = 'üéâ ¬°Correcto! ¬°Has adivinado el n√∫mero!';
      } else if (entrada < numeroSecreto) {
        resultado.textContent = 'üìâ Demasiado bajo.';
      } else {
        resultado.textContent = 'üìà Demasiado alto.';
      }

      if (intentos === 0 && entrada !== numeroSecreto) {
        resultado.textContent += ' El n√∫mero era ' + numeroSecreto + '.';
      }
    }

    // ---------- CONEXI√ìN CON LA API ----------
    document.getElementById('guardar').addEventListener('click', () => {
      const nombre = document.getElementById('nombre').value;
      const intentosRestantes = parseInt(document.getElementById('intentos').textContent);
      const intentosUsados = 10 - intentosRestantes;

      if (!nombre || isNaN(intentosUsados)) {
        document.getElementById('mensajeGuardado').textContent = 'Pon un nombre v√°lido y juega al menos una vez.';
        return;
      }

      fetch('api-partidas-production.up.railway.app', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          jugador: nombre,
          intentos: intentosUsados
        })
      })
      .then(res => {
        if (!res.ok) throw new Error('Error al guardar');
        return res.json();
      })
      .then(data => {
        document.getElementById('mensajeGuardado').textContent = `‚úÖ Partida guardada con ID ${data.id}`;
      })
      .catch(err => {
        document.getElementById('mensajeGuardado').textContent = `‚ùå Error: ${err.message}`;
      });
    });
  </script>
</body>
</html>
